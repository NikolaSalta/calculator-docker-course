"""
═══════════════════════════════════════════════════════════════════════════════
test_config.py — Конфигурация тестов
═══════════════════════════════════════════════════════════════════════════════

Этот файл содержит все настройки, которые могут меняться
в зависимости от окружения (локально, в Docker, в CI/CD).

Почему используем переменные окружения?
──────────────────────────────────────────
В разных окружениях URL-ы сервисов разные:

- В Docker Compose:
  BACKEND_URL = http://backend:8080
  (backend — имя сервиса в compose)

- Локально (без Docker):
  BACKEND_URL = http://localhost:8080

Переменные окружения позволяют не менять код при смене окружения.
Просто передаём другие значения:
  BACKEND_URL=http://localhost:8080 pytest

Как работает os.getenv():
──────────────────────────────────────────
os.getenv("BACKEND_URL", "http://backend:8080")
           │               │
           │               └── Значение по умолчанию (если переменной нет)
           └── Имя переменной окружения

Если переменная BACKEND_URL установлена — используется её значение.
Если нет — используется значение по умолчанию.
═══════════════════════════════════════════════════════════════════════════════
"""

# os — стандартный модуль Python для работы с операционной системой
# os.getenv() — получить переменную окружения
import os


# ═══════════════════════════════════════════════════════════════════════════════
# URL-ы СЕРВИСОВ
# ═══════════════════════════════════════════════════════════════════════════════

# URL backend-сервиса для HTTP-запросов
#
# В Docker: http://backend:8080
#   - "backend" — имя сервиса из docker-compose.yml
#   - Docker DNS резолвит это имя в IP контейнера
#   - :8080 — порт, на котором слушает Spring Boot
#
# Локально: http://localhost:8080
#   - localhost — твой компьютер
#   - :8080 — проброшенный порт контейнера (или запущенный локально backend)
BACKEND_URL = os.getenv("BACKEND_URL", "http://backend:8080")

# URL frontend-сервиса
#
# В Docker: http://frontend:80
#   - "frontend" — имя сервиса
#   - :80 — стандартный HTTP порт nginx
#
# Локально: http://localhost:3000
#   - :3000 — порт, на который проброшен контейнер (или dev-сервер React)
FRONTEND_URL = os.getenv("FRONTEND_URL", "http://frontend:80")


# ═══════════════════════════════════════════════════════════════════════════════
# НАСТРОЙКИ SELENIUM
# ═══════════════════════════════════════════════════════════════════════════════

# URL Selenium Hub (координатор браузеров)
#
# Selenium Grid состоит из:
# - Hub (хаб): принимает WebDriver-запросы, распределяет по нодам
# - Node (нода): содержит браузер (Chrome, Firefox)
#
# http://selenium-hub:4444 — Hub в Docker Compose
# :4444 — стандартный порт Selenium Grid
#
# Если SELENIUM_HUB_URL не установлен — UI-тесты не будут работать
SELENIUM_HUB_URL = os.getenv("SELENIUM_HUB_URL", "http://selenium-hub:4444")

# ═══════════════════════════════════════════════════════════════════════════════
# SELENIUM REMOTE URL — для прямого подключения к standalone-chrome
# ═══════════════════════════════════════════════════════════════════════════════
#
# Используется с selenium/standalone-chrome (с noVNC).
# Формат: http://hostname:4444/wd/hub
#
# Преимущество standalone-chrome:
# - Встроенный VNC/noVNC сервер
# - Можно видеть браузер в реальном времени: http://localhost:7900
SELENIUM_REMOTE_URL = os.getenv("SELENIUM_REMOTE_URL", SELENIUM_HUB_URL)

# Какой браузер использовать для Selenium-тестов
# Варианты: "chrome", "firefox"
# Chrome обычно быстрее и стабильнее
BROWSER = os.getenv("BROWSER", "chrome")

# ═══════════════════════════════════════════════════════════════════════════════
# HEADLESS MODE — режим без графического интерфейса
# ═══════════════════════════════════════════════════════════════════════════════
#
# HEADLESS=true  — браузер без GUI (быстрее, меньше ресурсов, для CI/CD)
# HEADLESS=false — браузер с GUI (можно видеть через VNC/noVNC)
#
# По умолчанию: true (headless) — для совместимости с CI/CD
# Для визуального тестирования установите: HEADLESS=false
HEADLESS = os.getenv("HEADLESS", "true").lower() in ("true", "1", "yes")

# ═══════════════════════════════════════════════════════════════════════════════
# USE_EMBEDDED_BROWSER — использовать встроенный браузер
# ═══════════════════════════════════════════════════════════════════════════════
#
# USE_EMBEDDED_BROWSER=true  — использовать Chromium внутри контейнера тестов
# USE_EMBEDDED_BROWSER=false — подключаться к внешнему Selenium Grid/noVNC
#
# Встроенный браузер:
# + Не требует дополнительных контейнеров
# + Быстрее запускается
# + Проще в использовании
# - Нельзя видеть браузер (только headless)
#
# Внешний Selenium (noVNC):
# + Можно видеть браузер в реальном времени
# + VNC доступ через http://localhost:7900
# - Требует дополнительного контейнера
USE_EMBEDDED_BROWSER = os.getenv("USE_EMBEDDED_BROWSER", "false").lower() in ("true", "1", "yes")


# ═══════════════════════════════════════════════════════════════════════════════
# ТАЙМАУТЫ
# ═══════════════════════════════════════════════════════════════════════════════

# Сколько секунд ждать готовности сервисов перед запуском тестов
#
# В Docker контейнеры запускаются не мгновенно:
# - Backend: ~10-30 сек (JVM startup, Spring initialization)
# - Frontend: ~5 сек (nginx запускается быстро)
# - Selenium: ~10-20 сек (Hub + Chrome)
#
# 60 секунд обычно достаточно для локальной машины
# В CI/CD может понадобиться больше (90-120 сек)
STARTUP_WAIT = int(os.getenv("STARTUP_WAIT", "60"))

# Таймаут для одного HTTP-запроса (секунды)
#
# Если сервер не отвечает за это время — requests бросит исключение.
# 10 секунд достаточно для локальных запросов.
# Для медленных операций можно увеличить.
REQUEST_TIMEOUT = int(os.getenv("REQUEST_TIMEOUT", "10"))
