# ═══════════════════════════════════════════════════════════════════════════
# docker-compose.prebuilt.yml — Запуск из готовых образов
# ═══════════════════════════════════════════════════════════════════════════
#
# Этот файл использует ГОТОВЫЕ образы из Docker Hub или GitHub CR.
# Не требует сборки — просто скачивает и запускает.
#
# Использование:
#   docker compose -f docker-compose.prebuilt.yml up -d
#
# Для использования своих образов измените переменные:
#   export DOCKER_USERNAME=your-username
#   docker compose -f docker-compose.prebuilt.yml up -d
# ═══════════════════════════════════════════════════════════════════════════


services:

  # ─────────────────────────────────────────────────────────────────────────
  # BACKEND SERVICE
  # ─────────────────────────────────────────────────────────────────────────
  backend:
    # Используем готовый образ вместо сборки
    # Замените 'your-username' на ваш username Docker Hub
    image: ${DOCKER_USERNAME:-your-username}/calculator-docker-backend:latest
    
    container_name: calc-backend
    
    ports:
      - "8080:8080"
    
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/api/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s
    
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    
    restart: unless-stopped


  # ─────────────────────────────────────────────────────────────────────────
  # FRONTEND SERVICE
  # ─────────────────────────────────────────────────────────────────────────
  frontend:
    # Используем готовый образ вместо сборки
    image: ${DOCKER_USERNAME:-your-username}/calculator-docker-frontend:latest
    
    container_name: calc-frontend
    
    ports:
      - "3001:80"
    
    depends_on:
      backend:
        condition: service_healthy
    
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M
    
    restart: unless-stopped


# ═══════════════════════════════════════════════════════════════════════════
# ИСПОЛЬЗОВАНИЕ
# ═══════════════════════════════════════════════════════════════════════════
#
# 1. Установите username:
#    export DOCKER_USERNAME=nikolay  # замените на свой
#
# 2. Запустите:
#    docker compose -f docker-compose.prebuilt.yml up -d
#
# 3. Откройте:
#    http://localhost:3001
#
# 4. Остановите:
#    docker compose -f docker-compose.prebuilt.yml down
# ═══════════════════════════════════════════════════════════════════════════

